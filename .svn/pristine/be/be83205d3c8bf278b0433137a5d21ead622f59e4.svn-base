@{
    ViewBag.Title = "FileUploader";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="@Url.Content("~/Content/uploadify/jquery.uploadify.v2.1.4.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Content/uploadify/swfobject.js")" type="text/javascript"></script>
<div>
    <div class="main_createaccount">
            <h1 class="createaccount_heading">
                File Uploader</h1>
            <span class="heading_bottomline"></span>
        </div>
    <div id="divSelectFileType">
        1.) Select what type of files you are uploading.
        <br/>
        <select id="ddlFileType">
            <option selected="selected" value="MyGMImages">GM</option>
            <option value="MyTRImages">Trade</option>
            <option value="MyTXImages">Text</option>
            <option value="OtherFiles">Other</option>
        </select>
        <input type="button" value="Next >>" id="btnNext" />
        <br/>
        <span id="spanSelectedFolder"></span>
    </div>
     <br/>
    <div id="divFileUploader" style="display: none;">
        2.) Add your files. (.gif, .jpg, .jpeg, .pdf, .doc, .docx allowed)
        <br/>
        <div class="demo-box">
            <div id="status-message"></div>
            
             <p style="color: Red;"  id="loading"></p>
             
            <div id="custom-queue">
                
            </div>
            <br/>
            <br/>
            <input id="custom_file_upload" type="file" name="Filedata" />
        </div>
    </div>
    <script type="text/javascript">

        jQuery("#btnNext").click(function () {

            var selected = jQuery("#ddlFileType").val();

            jQuery("#spanSelectedFolder").html(selected + " Selected ");

            jQuery("#ddlFileType").hide();

            jQuery("#divFileUploader").show();

            jQuery("#btnNext").hide();

            var requiredMajorVersion = 9;

            // Minor version of Flash required
            var requiredMinorVersion = 0;

            // Minor revision of Flash required
            var requiredRevision = 0;

            var hasReqestedVersion = 1; //DetectFlashVer(requiredMajorVersion, requiredMinorVersion, requiredRevision);

            if (hasReqestedVersion) {

                //                var foldername = jQuery("ddlFileType").val();

                //                alert(foldername);

                $('#custom_file_upload').uploadify({
                    'uploader': '@Url.Content("~/Content/uploadify/uploadify.swf")',
                    'script': '@Url.Action("AttachFiles", "Admin")',
                    'cancelImg': '@Url.Content("~/Content/images/Mobile/Delete_Black.png")',
                    'folder': selected,
                    'multi': true,
                    'auto': true,
                    'fileExt': '*.gif,*.doc;*.docx;*.pdf;*.jpg;*.jpeg',
                    'fileDesc': 'Images,Documents',
                    'queueID': 'custom-queue',
                    'queueSizeLimit': 5,
                    'simUploadLimit': 5,
                    'removeCompleted': true,
                    'onSelect': function(event, data) {

                        $("#loading").html('<img src="@Url.Content("~/Content/images/Mobile/loading_normal_up.gif")"/>');

//                        $('#status-message').html(data.filesSelected + ' files have been added to the queue.');
                    },
                    'onComplete': function(event, id, fileObj, response, data) {

                        $("#loading").html("");

                        var msg = $.parseJSON(response);

                        if (msg.success) {
                            $("#status-message").html("<font style='colors:red'><b>File(s) are uploaded</b></font>");

                        } else {

                            $("#status-message").html("<font style='colors:red'><b>Format of the file is not valid</b></font>");
                        }
                    },
                    'onAllComplete': function (event, data) {
                        window.location.href = '@Url.Action("FileUploadDone","Admin")';
                       
                    }
                });
            } else {
                var alternateContent = '<p>This content requires the Adobe Flash Player version ' + requiredMajorVersion + '.<br />' + '<a target="_blank" href=http://www.adobe.com/go/getflashplayer>Get Flash</a></p>';

                $('#demo-box').replaceWith(alternateContent);
            }
        });

    </script>
</div>
