@using CampusWebStore.Shared.Models
@model IEnumerable<CampusWebStore.Shared.Models.ShoppingCartModel>
@{
    ViewBag.Title = "CheckOut";
    Layout = "~/Views/Shared/_Layout.iPhone.cshtml";

    var cartTotal = 0.0;
}
<script type="text/javascript">

    jQuery(document).ready(function () {

        //Show Custom shipping info box.. 
        jQuery('input[id*="chkShippingThisTime"]').click(function () {

            var status = jQuery('input[id*="chkShippingThisTime"]').is(":checked") ? "on" : "off";

            if (status == "on") {

                jQuery("#divAddress").hide();

                jQuery("#divShipping").show();

            } else {

                jQuery("#divAddress").show();

                jQuery("#divShipping").hide();
            }

        });

        //Do Payment after finalize order....
        jQuery('input[id*="btnMakePayment"]').click(function () {

            if (jQuery('input[id*="chkPolicyAgree"]').is(":checked")) {

                jQuery("#imgLoading").show();

                jQuery("#spanError").hide();

                jQuery.ajax({
                    type: 'POST',
                    dataType: 'json',
                    url: '@Url.Action("JsonDoPayment", "Shipping")',
                    data: {
                        CardType: jQuery("#ddlPayCardType").val(),
                        ExpiryDate: jQuery("#ddlPayExpMonth").val() + jQuery("#ddlPayExpMonth").val().substr(2, 2),
                        CardNo: jQuery("#txtCardNo").val(),
                        CIDNo: jQuery("#txtPayCIDNumber").val(),
                        PromoCode: jQuery("#txtPromoCode").val(),
                        SubTotal: jQuery("#spnSubTotal").text()
                    },
                    success: function (data) {
                        if (data.success) {
                            jQuery("#imgLoading").show();

                            window.location.href = "";
                        }
                    }
                });
            } else {


                jQuery("#spanError").show();

                jQuery("#spanError").html("Please read and agree to checkout policy.");
            }
        });
    });
    fnGetShippingMethods();
    var status = "off";

    //function to get Shipping Methods details.....
    function fnGetShippingMethods() {
        jQuery("#imgLoading").show();

        jQuery("#divAddress").hide();

        jQuery.ajax({
            type: 'POST',
            dataType: 'json',
            url: '@Url.Action("JsonGetShippingMethodDetails", "Shipping")',
            data: {
                IsAllowSubscription: jQuery('input[id*="chkShippingThisTime"]').is(":checked"),
                IsShippingThisTime: jQuery('input[id*="chkShippingThisTime"]').is(":checked"),
                ShipToName: jQuery("#txtShipToName").val(),
                ShipAddress: jQuery("#txtShipToAddress").val(),
                ShipAddress2: jQuery("#txtShipToName").val(),
                ShipCity: jQuery("#txtShipToAddress").val(),
                ShipState: jQuery("#txtShipToName").val(),
                ShipZip: jQuery("#txtShipToAddress").val(),
                ShipCountry: jQuery("#txtShipToAddress").val(),
                ShipInstructions: jQuery("#txtShipInstructions").val()
            },
            success: function (data) {

                jQuery("#imgLoading").hide();

                jQuery("#divShipping").hide();

                if (data.success) {

                    var strTable = '<table cellpadding="0" cellspacing="0" border="0" class="tXtBook carttable" id="tblShippingMethods">';

                    strTable += "<tr>";

                    strTable += "<th>Select Shipping Method</th>";

                    strTable += "<th>Amount</th>";

                    strTable += "<th>Select</th>";

                    strTable += "</tr>";

                    for (var i = 0; i < data.ShippingMethods.length; i++) {
                        strTable += "<tr>";

                        strTable += "<td>" + data.ShippingMethods[i].Display + "</td>";

                        strTable += "<td>" + data.ShippingMethods[i].Amount + "</td>";

                        strTable += "<td><a href=" + '"' + "javascript:fnGetTax('" + data.ShippingMethods[i].Display + "','" + data.ShippingMethods[i].Amount + "','" + data.ShippingMethods[i].Table + "');" + '"' + ">Select</a></td>";

                        strTable += "</tr>";

                    }

                    strTable += "</table>";

                    jQuery("#divShippingSelection").html(strTable);

                    jQuery("#divShippingSelection").show();

                    jQuery("#divShippingThisTime").hide();


                } else {

                }
            }
        });
    }

    //function to get tax
    function fnGetTax(name, amt, table) {

        jQuery("#imgLoading").show();

        jQuery.ajax({
            type: 'POST',
            dataType: 'json',
            url: '@Url.Action("JsonGetShippingTax", "Shipping")',
            data: {
                ShipName: name,
                Amount: amt,
                Table: table
            },
            success: function (data) {

                jQuery("#imgLoading").hide();

                jQuery("#divShipping").hide();

                if (data.success) {

                    var tax = data.objTaxModel.Tax;

                    var subTotal;

                    jQuery("#spnTax").html(tax);

                    jQuery("#spnShippingCost").html(amt);

                    subTotal = parseFloat(jQuery("#spnCartTotal").text().replace('$', '')) + parseFloat(tax.replace('$', '')) + parseFloat(amt.replace('$', ''));

                    jQuery("#spnSubTotal").html("$" + subTotal.toFixed(2));

                    for (var i = 0; i < data.objTaxModel.PaymentMethods.length; i++) {

                        jQuery("<option value='" + data.objTaxModel.PaymentMethods[i].Tender + "'>" + data.objTaxModel.PaymentMethods[i].Type + "</option>").appendTo("#ddlPayCardType");
                    }

                    jQuery("#imgLoading").hide();

                    jQuery("#tblPayment").show();


                } else {

                }
            }
        });
    }
   
</script>
<script type="text/javascript">

    $('#page1').live('pageinit', function (event) {
        $("#my-form").bind("submit", function () {


        });
    });

    function fnAddCategory() {


        $.mobile.changePage('@Url.Action("Index", "admin")', "flip", true, false);

    }
    //       
    //    });
   
    
</script>
<script src="@Url.Content("~/Scripts/jquery.mobile-1.0b3.js")" type="text/javascript"></script>
<link href="@Url.Content("~/Content/jquery.mobile-1.0b2.css")" rel="stylesheet" type="text/css" />
<div id="headerproduct">
    <!--header-->
    <img  src="@Url.Content("~/Content/images/Mobile/bar_top.png")" width="181" alt="CampusWebstore" title="CampusWebstore" id="logo"/>
</div>
<div class="cartcontainer">
    <div id="form">
        <form id="frmCourse" runat="server">
        @Html.Partial("EditorTemplates/MobileHeader")
        <div class="clear">
        </div>
        <div class="bradecumpro">
            <a href="#" class="left">Course</a>
        </div>
            <div>
                <section id="page1" data-role="page">
                    <header data-role="header"><h1>Verify Address</h1></header>
                    <div data-role="content" class="content">
                        <div>
                            <table>
                                <tr>
                                    <td>
                                        <h4>
                                            Progress...</h4>
                                            <br /><br />
                                        1. <a href="#page3" data-rel="dialog">Verify Address</a>
                                        <br /><br />
                                      
                                        2.<a a href="#page7" id="selectShip" data-rel="dialog" >Select Shipping Method </a>
                                        <br /><br />
                                        3.<a href="#">Make Payment/Finalize Order</a><br /> <br /><br />
                                    </td>
                                    <td>
                                      
                                    </td>
                                </tr>
                            </table>
                        </div>
                        <p><a href="#page2">Next</a></p>
                    </div>
                </section>
                <section id="page2" data-role="page">
                    <header data-role="header"><h1>Cart Detail</h1></header><div data-role="content" class="content">
                                                                                <table cellpadding="0" cellspacing="0" border="0" class="tXtBook carttable">
                                                                                    <tr>
                                                                                        <td>
                                                                                            <input type="checkbox" checked="checked" id="chkAllowSubscription"><label for="chkAllowSubscription">
                                                                                                                                                                   Allow Substitutions on this order
                                                                                                                                                               </label>
                                                                                            <img style="border-width: 0px;" src="#" id="imageSubHelp" alt="" />
                                                                                        </td>
                                                                                    </tr>
                                                                                    <tr>
                                                                                        <th>
                                                                                            Item
                                                                                        </th>
                                                                                        <th>
                                                                                            Detail
                                                                                        </th>
                                                                                        <th>
                                                                                            Type
                                                                                        </th>
                                                                                        <th>
                                                                                            Price
                                                                                        </th>
                                                                                        <th>
                                                                                            Qty
                                                                                        </th>
                                                                                        <th>
                                                                                            Ext
                                                                                        </th>
                                                                                    </tr>
                                                                                    @foreach (var m in Model)
                                                                                    {
                                                                                        cartTotal = m.Total;
                
                                                                                        <tr>
                                                                                            <td>@MvcHtmlString.Create(m.Title)
                                                                                            </td>
                                                                                            <td>@m.Detail
                                                                                            </td>
                                                                                            <td>@m.Type
                                                                                            </td>
                                                                                            <td>@m.ActualPrice
                                                                                            </td>
                                                                                            <td>@m.Qty
                                                                                            </td>
                                                                                            <script type="text/javascript">$("#"+@m.Id).val(@m.Qty); </script>
                                                                                            <td>@m.Total
                                                                                            </td>
                                                                                        </tr>
                                                                                    }
                                                                                    <tr>
                                                                                        <td colspan="6" style="text-align: right;">@Html.ActionLink("Modify Items", "ViewCartDetail", "Home")
                                                                                        </td>
                                                                                    </tr>
                                                                                </table>  <p> <a href="#page1">Pre</a> | <a href="#page3">Next</a></p></div>
                </section>
                <section id="page3" data-role="page">
                    <header data-role="header"><h1>Cart Detail</h1></header><div data-role="content" class="content">
                                                                                   
                                                                                <table>
                                                                                    <tr>
                                                                                        <td style="text-align: left;">
                                                                                            @{
                                                                                                var objUserModel = (UserModel)Session["USERINFO"];
                        
                                                                                            }
                                                                                            <div>
                                                                                                <img id="imgLoading" src="@Url.Content("~/Content/images/Mobile/loading_normal_up.gif")" alt="loading" style="display: none;"/>
                                                                                                <div id="divAddress">
                                                                                                    <table cellpadding="0" cellspacing="0" border="0" class="tXtBook carttable">
                                                                                                        <tr>
                                                                                                            <td>
                                                                                                                <table id="tblBillingInfo">
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            <b>Billing Info</b>
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>@objUserModel.FirstName
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>@objUserModel.Address
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>@objUserModel.Address2
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>@objUserModel.City , @objUserModel.State @objUserModel.Zip
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            @objUserModel.Country
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                </table>
                                                                                                            </td>
                                                                                                            <td>
                                                                                                                <table>
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            <b>Shipping Info</b>
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>@objUserModel.ShipToName
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>@objUserModel.ShipAddress
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>@objUserModel.ShipAddress2
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>@objUserModel.ShipCity , @objUserModel.ShipState @objUserModel.ShipZip
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>@objUserModel.ShipCountry
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                </table>
                                                                                                            </td>
                                                                                                        </tr>
                                                                                                    </table>
                                                                                                    <br />
                                                                                                    @Html.ActionLink("Change your address on file", "AccountDetails", "Account")
                                                                                                </div>
                                                                                                <span></span>
                                                                                                <div id="divShipping" style="display: none;">
                                                                                                    <span style="font-weight: bold; font-size: 18px">Custom Shipping Address:</span>
                                                                                                    <table cellpadding="0" cellspacing="0" border="0" class="tXtBook carttable">
                                                                                                        <tr>
                                                                                                            <td>
                                                                                                                <table>
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            Ship To Name:
                                                                                                                        </td>
                                                                                                                        <td>
                                                                                                                            <input type="text" id="txtShipToName" name="txtShipToName" />
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            Address:
                                                                                                                        </td>
                                                                                                                        <td>
                                                                                                                            <input type="text" id="txtShipToAddress" name="txtShipToName" />
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            Address2:
                                                                                                                        </td>
                                                                                                                        <td>
                                                                                                                            <input type="text" id="txtShipToAddress2" name="txtShipToName" />
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            City:
                                                                                                                        </td>
                                                                                                                        <td>
                                                                                                                            <input type="text" id="txtShipToCity" name="txtShipToName" />
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                </table>
                                                                                                            </td>
                                                                                                            <td>
                                                                                                                <table>
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            State:
                                                                                                                        </td>
                                                                                                                        <td>
                                                                                                                            <input type="text" id="txtState" name="txtState" />
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            Zip:
                                                                                                                        </td>
                                                                                                                        <td>
                                                                                                                            <input type="text" id="txtZip" name="txtZip" />
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            Country:
                                                                                                                        </td>
                                                                                                                        <td>
                                                                                                                            <input type="text" id="txtCountry" name="txtCountry" />
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                    <tr>
                                                                                                                        <td>
                                                                                                                            Ship Instructions:
                                                                                                                        </td>
                                                                                                                        <td>
                                                                                                                            <input type="text" id="txtShipInstructions" name="txtShipInstructions" />
                                                                                                                        </td>
                                                                                                                    </tr>
                                                                                                                </table>
                                                                                                            </td>
                                                                                                        </tr>
                                                                                                    </table>
                                                                                                </div>
                                                                                               
                                                                                                <div id="divShippingThisTime">
                                                                                                    <input type="checkbox" id="chkShippingThisTime" name="chkShippingThisTime" />
                                                                                                    <label for="chkShippingThisTime">Check to use a 'this time only' shipping address</label>
                                                                                                </div>
                        
                                                                                            </div>
                                                                                        </td>
                                                                                        <td style="vertical-align: top;">
                                                                                            <!-- cart info box -->
                                                                                 @*           <table cellpadding="0" cellspacing="0" border="0" class="tXtBook carttable">
                                                                                                <tr>
                                                                                                    <td class="textalignleft">
                                                                                                        <b>Cart Total:</b>
                                                                                                    </td>
                                                                                                    <td class="textalignright">
                                                                                                        <span id="spnCartTotal">@cartTotal.ToString("C")</span>
                                                                                                    </td>
                                                                                                </tr>
                                                                                                <tr>
                                                                                                    <td class="textalignleft">
                                                                                                        <b>Shipping:</b>
                                                                                                    </td>
                                                                                                    <td class="textalignright">
                                                                                                        <span id="spnShippingCost">N/A</span>
                                                                                                    </td>
                                                                                                </tr>
                                                                                                <tr>
                                                                                                    <td class="textalignleft">
                                                                                                        <b>Tax:</b>
                                                                                                    </td>
                                                                                                    <td class="textalignright">
                                                                                                        <span id="spnTax">N/A</span>
                                                                                                    </td>
                                                                                                </tr>
                                                                                                <tr>
                                                                                                    <td class="textalignleft">
                                                                                                        <b>Subtotal:</b>
                                                                                                    </td>
                                                                                                    <td class="textalignright">
                                                                                                        <span id="spnSubTotal">N/A</span>
                                                                                                    </td>
                                                                                                </tr>
                                                                                            </table>*@
                                                                                        </td>
                                                                                    </tr>
                                                                                </table>@*<p> <a href="#page2">Pre</a></p>*@
                                                                            </div> @* <div data-type="horizontal" data-role="controlgroup" class="ui-corner-all ui-controlgroup ui-controlgroup-horizontal">
                                        <a data-icon="plus" data-role="button" href="#" id="btnContinueShopping"
                                           style="background: #F39C24;" data-theme="c" class="ui-btn ui-corner-left ui-btn-up-c">
                                            <span class="ui-btn-inner ui-corner-left"><span class="ui-btn-text">Shopping</span></span></a>
                                        <a data-role="button" style="background: #F39C24;" href="#"  id="btnMakePayment" data-theme="c" class="ui-btn ui-corner-undefined ui-btn-up-c">
                                            <span class="ui-btn-inner ui-corner-left"><span class="ui-btn-text">Pay</span></span></a>
                                        <a data-icon="minus" data-role="button" style="background: #F39C24;" id="btnGoToShipping" href="#" data-theme="c"
                                           class="ui-btn ui-btn-up-c ui-corner-right ui-controlgroup-last">
                                            <span class="ui-btn-inner ui-corner-right ui-controlgroup-last"><span class="ui-btn-text">
                                                                                                                &#10004 out</span></span></a>
                                    </div>*@</section>
                <section id="page7" data-role="page"> <header data-role="header"><h1>Select Shipping</h1></header><div data-role="content" class="content"> <div id="divShippingSelection" style="display: none;">
                                                                                                    <!--Fill by Ajax  -->
                                                                                                                                                        </div></div></section>                                                  
                                                                                               
                <section id="page4" data-role="page">
                    <header data-role="header"><h1>Cart Detail</h1></header><div data-role="content" class="content">
                                                                                <table cellpadding="0" cellspacing="0" border="0" class="tXtBook carttable" id="tblPayment">
                                                                                    <tr>
                                                                                        <td style="vertical-align: top;">
                                                                                          
                                                                              
                                                                                            <br/>
                                                                                            <input type="checkbox" id="chkPolicyAgree" /><label for="chkPolicyAgree">I Agree</label>
                                                                                        </td>
                                                                                        <td>
                                                                                            <table cellpadding="0" cellspacing="0" border="0" class="tXtBook carttable" class="PaymentBox">
                                                                                                <tbody>
                                                                                                    <tr>
                                                                                                        <td class="textalignleft">
                                                                                                            Type:
                                                                                                        </td>
                                                                                                        <td class="textalignright">
                                                                                                            <select id="ddlPayCardType">
                                                                                                                @* <option value="NA" selected="selected">Please Select...</option>
                                                            <option value="CC">Visa</option>
                                                            <option value="CC">Master Card</option>
                                                            <option value="CC">Discover Card</option>
                                                            <option value="CA">Cash</option>*@
                                                                                                            </select>
                                                                                                        </td>
                                                                                                    </tr>
                                                                                                    <tr>
                                                                                                        <td class="textalignleft">
                                                                                                            Card#:
                                                                                                        </td>
                                                                                                        <td class="textalignright">
                                                                                                            <input type="text" id="txtCardNo" />
                                                                                                        </td>
                                                                                                    </tr>
                                                                                                    <tr>
                                                                                                        <td class="textalignleft">
                                                                                                            Exp Date:
                                                                                                        </td>
                                                                                                        <td class="textalignright">
                                                                                                            <select id="ddlPayExpMonth">
                                                                                                                <option value="01" selected="selected">01 - Jan</option>
                                                                                                                <option value="02">02 - Feb</option>
                                                                                                                <option value="03">03 - Mar</option>
                                                                                                                <option value="04">04 - Apr</option>
                                                                                                                <option value="05">05 - May</option>
                                                                                                                <option value="06">06 - Jun</option>
                                                                                                                <option value="07">07 - Jul</option>
                                                                                                                <option value="08">08 - Aug</option>
                                                                                                                <option value="09">09 - Sep</option>
                                                                                                                <option value="10">10 - Oct</option>
                                                                                                                <option value="11">11 - Nov</option>
                                                                                                                <option value="12">12 - Dec</option>
                                                                                                            </select>
                                                                                                            <select id="ddlPayExpYear">
                                                                                                                <option value="2012" selected="selected">2012</option>
                                                                                                                <option value="2013">2013</option>
                                                                                                                <option value="2014">2014</option>
                                                                                                                <option value="2015">2015</option>
                                                                                                                <option value="2016">2016</option>
                                                                                                                <option value="2017">2017</option>
                                                                                                                <option value="2018">2018</option>
                                                                                                                <option value="2019">2019</option>
                                                                                                                <option value="2020">2020</option>
                                                                                                                <option value="2021">2021</option>
                                                                                                            </select>
                                                                                                        </td>
                                                                                                    </tr>
                                                                                                    <tr>
                                                                                                        <td class="textalignleft">
                                                                                                            CID
                                                                                                        </td>
                                                                                                        <td class="textalignright">
                                                                                                            <input type="text" id="txtPayCIDNumber">
                                                                                                            <img src="#" id="imgHelpCID" alt="" />
                                                                                                        </td>
                                                                                                    </tr>
                                                                                                    <tr>
                                                                                                        <td class="textalignleft">
                                                                                                            Promo Code:
                                                                                                        </td>
                                                                                                        <td class="textalignright">
                                                                                                            <input type="text" id="txtPromoCode" />
                                                                                                        </td>
                                                                                                    </tr>
                       
                                                                                                </tbody>
                                                                                            </table>
                                                                                        </td>
                                                                                    </tr>
                                                                                </table><p> <a href="#page3">Pre</a> </p></div></section>
                                                                                                                                                   
               <span class="clr"></span><br />
                <div style="clear:both"></div>
                <div>
                 </div>
                <span class="clr"></span></div>
        </form>
    </div>
   
</div>
